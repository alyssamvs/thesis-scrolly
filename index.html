<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laws of a Forever War: Visualising drug policy in the context of the global cocaine trade</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Readex+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  
  <link rel="stylesheet" href="./css/main.css" />
  <link rel="stylesheet" href="./css/rankings.css" />

  <!-- JS -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
  <script src="./javascript/geographic-network.js"></script>
  <script src="./javascript/treaty-network.js" defer></script>
  <script src="./javascript/rankings.js" defer></script>
  <script src="./javascript/main.js" defer></script>

</head>   
</head>


<script>
    function selectCharacter(character) {
        // Map character names to their CYOA pages
        const characterPages = {
            'farmer': './farmer-cyoa.html',
            'courier': './courier-cyoa.html',      // Not built yet
            'dealer': './dealer-cyoa.html',        // Not built yet
            'transporter': './transporter-cyoa.html', // Not built yet
            'producer': './producer-cyoa.html',    // Not built yet
            'wholesaler': './wholesaler-cyoa.html' // Not built yet
        };

        const page = characterPages[character];
        
        if (page) {
            // Navigate to the character's CYOA page
            window.location.href = page;
        } else {
            console.error('Character page not found:', character);
            alert('This character story is not yet available. Please try another character or check back soon!');
        }
    }
</script>



<body>
<!-------------------------
---------------------------
    Header Navigation (this should disappear in the hero)
---------------------------
---------------------------->
    <header class="header">
        <div class="nav-container">
            <div class="logo">:</div>
            <div class="nav-buttons">
                <button class="nav-btn" onclick="goToSection('story')">Story Mode</button>
                <button class="nav-btn" onclick="goToSection('dashboard')">Dashboard</button>
            </div>
        </div>
    </header>

<!-------------------------
---------------------------
    PROGRESS BAR 
---------------------------
---------------------------->
    <div class="progress-bar" id="progressBar"></div>

<!------------------------
    ----------------------
    HERO TITLE (full-page) 
--------------------------
---------------------------->

    <section class="cover" id="cover">
        <h1>LAWS OF A FOREVER WAR</h1>
        <div class="subtitle">Visualising drug policy in the context of the global cocaine trade</div>
        <div class="description">

        </div>
        <div class="mode-buttons">
            <button class="mode-btn" onclick="startStoryMode()">Story Mode</button>
            <button class="mode-btn" onclick="goToDashboard()">Dashboard</button>
        </div>
        <div class="scroll-indicator">
            <div class="scroll-arrow"></div>
        </div>
    </section>

<!-- ---------------------
    ----------------------
    SCROLLY SECTION 
--------------------------
---------------------------->

    <!-- SECTION 1 - INTRO -->

    <section class="story-section intro" id="intro">
        <!-- <h2 class="section-header">1. Cocaine: An Abridged History</h2> -->
        <div class="section-content">
             <div class="captions">
                <div class="caption">
                    <p>
                        In the 1860s, a beverage made out of wine and coca leaves was marketed around the world as a cure-all: you could take it to stay awake, to increase energy, to alleviate pain and enhance artistic and athletic performance. ‘Vin Mariani’ (so named after its creator, a French chemist) was endorsed by popes, drank by celebrities, and enjoyed by millions.
                    <br><br>
                    It contained around 220mg of cocaine per litre. </p>
                </div>
                
                <div class="caption full-width-image-caption">
                    <img src="./assets/mariani-cropped2.webp" alt="Vin Mariani" class="full-width-image">
                </div>
                
                <div class="caption">
                  <p>
                
                Coca plants (<i>Erythroxylum coca</i>), the shrub-like bushes from which cocaine is extracted, have a long history of cultivation in South America: in the Andes mountains their leaves have been ground for energy and pain relief by indigenous people since 8000 B.C.E.. First described to Western science in the 18th century, its compounds were chemically isolated in 1855 and from there, its use spread rapidly.
                <br><br>
                At the time of Vin Mariani's production no prohibition existed on coca leaves and cocaine. In fact, no prohibition existed for <i>any</i> type of drug, at least not in any way that could be considered comprehensive. So, same as with opium products, cocaine was freely used and beloved: it was added to medicine, drinks, tonics, mood enhancing elixirs, and even foods. Sigmund Freud famously advocated for its use, and it was an ingredient in the original recipe for Coca Cola until 1904.
                <br><br>
                Despite limited efforts to curb its use, in the first half of the twentieth century producing countries such as Peru and Bolivia experienced a boom in cocaine production. Processing plants were set up, export operations improved, and by the 1920s cocaine was a major commodity.
                <br><br>
                By 1947, however, the entire legal trade would end. 
                </p>
                <br><br>
                <br><br>
                <br><br>
                <br><br>
                <br><br>
                <br><br>
                

                </div>
                
              </div>

      
    </section>

 <!-- SECTION 2 - Treaties -->

 <section class="story-section treaties" id="treaties">
    <!-- <h2 class="section-header">3. A Legal System Catches Up</h2>
    <br><br>
    <h3>As mentioned, drug regulation in general is a relatively new phenomenom. The first document to declare at an international level the necessity to intervene in the commerce of certain substances dates back to 1909. Following the Second World War, a wave of prohibition instigated mainly by the United States of America lead to widespread pressure for countries to abide by these provisions. 
        <br><br>
    It took until 1961, however, for these treaties to have any teeth. <br><br>
    They haven't been updated much since then. 
    <br><br>
    </h3> -->
    <div class="section-content">

        <!-- Sticky graphic container -->
        <div class="sticky-bg" id="graphic-container">
            <!-- D3.js treaty network visualization will be rendered here -->

            <button id="explore-btn" class="explore-button">
                Click to Zoom/Pan
            </button>
        </div>
        
        <!-- Overlay captions -->
        <div class="captions">
            <div class="caption" data-index="0">
                <p>Drug prohibition, which accelerated at the end of the Second World War, was established at the international level by a series of treaties. This is a network showing most major international laws related to drug control, ordered by the year of their signature and connected to the works that precede or replace them. </p>
            </div>
            
            <div class="caption" data-index="1">
                <p>Over the years, the prohibitions laid out by these treaties expanded: starting first with substances called "narcotics", the UN's Single Convention of 1961 established prohibitions on opium, cocaine, cannabis and its derivatives. Later, the 1971 Vienna Convention added new psychotropic substances, plant-based hallucinogenics, and synthetic drugs to the list</p>
            </div>

            <div class="caption" data-index="2">
                <p>It was the 1988 Convention, though, which escalated the so-called 'war on drugs' by criminalising the entire drug supply chain from production to possession, providing legal frameworks for a more aggressive,global, and coordinated law enforcement response to drug control. </p>
            </div>

            <div class="caption" data-index="3">
                <p>Nowadays a multitude of international pieces of legislation exist: at the UN, regional, and local level, with varying degrees of adherance, and that each country may individually modify or update when codifying it into local law. Despite recent efforts towards legalisation or decriminalisation, however, the overarching international treaties that most countries are bound by remains largely unmodified.</p>
            </div>
             
            <div class="caption" data-index="4">
                <p>To explore the treaties in this network, and the local laws that expand them, hover over the node. To view the relationship between connected treaties, hover over the line that connects them.</p>
            </div>

        </div>                 
    </div>
</section>


    <!-- SECTION 3 - SUPPLY CHAIN -->

        <section class="story-section supply-chain" id="supply-chain">
            
            <div class="section-content">
                
                <div class="left-text">
                    <br><br>
                    <br><br>
                    <!-- <h2 class="section-header">2. The Supply Chain</h2> -->
                    <br><br>
                    <br><br>
                    <h3>Since 1988, and unofficially at least since the early 70s, all aspects of the drug market supply chain have been criminalised and subjected to enforcement, the mechanisms for which were quickly militarised militarised: from planes getting shot down in the 1970s, to Caribbean boats being the target of drones in 2025. With the so-called 'War on Drugs' being a war fought primarily on the <em>supply</em> of drugs, most of the regulatory, military and financial efforts were focused on this supply chain.
                        <br><br>
                    Click through the characters to the left to explore the roles different people play in the cocaine supply chain, and how drug policy affects them at each stage.

                </div>
                <div class="character-cards">
                    <div class="character-card" onclick="selectCharacter('farmer')">
                        <img src="./assets/farmer.png" alt="Coca Farmer" class="character-image">
                        <h3 class="character-name">Coca Farmer</h3>

                    </div>
                    <div class="character-card" onclick="selectCharacter('courier')">
                        <img src="./assets/burrier.png" alt="Courier" class="character-image">
                        <h3 class="character-name">Courier</h3>

                    </div>
                    <div class="character-card" onclick="selectCharacter('dealer')">
                        <img src="./assets/dealer.png" alt="Dealer" class="character-image">
                        <h3 class="character-name">Dealer</h3>

                    </div>
                    <div class="character-card" onclick="selectCharacter('transporter')">
                        <img src="./assets/dock-worker.png" alt="transporter" class="character-image">
                        <h3 class="character-name">Transporter</h3>

                    </div>
                    <div class="character-card" onclick="selectCharacter('producer')">
                        <img src="./assets/drug-lab.png" alt="producer" class="character-image">
                        <h3 class="character-name">Producer</h3>

                    </div>
                    <div class="character-card" onclick="selectCharacter('wholesaler')">
                        <img src="./assets/bricks.png" alt="Wholesaler" class="character-image">
                        <h3 class="character-name">Wholesaler</h3>

                    </div>
            </div>

        </section>


   
<!-- SECTION 4 - WAR AS POLICY -->
<section class="story-section" id="war-as-policy">
    <div class="section-content">
        
        <!-- Sticky graphic container -->
        <div class="sticky-bg" id="map-container">
          
         <!-- Controls -->
    <div class="map-controls">
        <div class="layer-toggles">
            <div class="toggle-title">Layers</div>
            <label class="toggle-item">
                <input type="checkbox" id="routing-toggle" checked>
                <span>Routes</span>
            </label>
            <label class="toggle-item">
                <input type="checkbox" id="choropleth-toggle">
                <span>Seizures per Year</span>
            </label>
        </div>
        <div class="metric-selector">
            <button class="metric-btn active" data-metric="seizure_count">Number of Seizures</button>
            <button class="metric-btn" data-metric="total_quantity_kg">Total Quantity (kg)</button>
        </div>
        
        <div class="year-filter">
            <div class="year-display-row">
                <span><strong>Year Range:</strong></span>
                <span class="year-display" id="geo-year-range-display">2011 - 2016</span>
                <button class="reset-year-btn" id="geo-reset-year">All Years</button>
            </div>
            <div class="year-slider-container">
                <span class="year-label">2011</span>
                <div class="slider-track">
                    <div class="slider-range" id="geo-slider-range"></div>
                    <input type="range" min="2011" max="2016" value="2011" class="year-slider" id="geo-year-start">
                    <input type="range" min="2011" max="2016" value="2016" class="year-slider" id="geo-year-end">
                </div>
                <span class="year-label">2016</span>
            </div>
        </div>
<!-- Legend -->
<div class="map-legend">
    <!-- <div class="legend-title">Visual Encoding</div>
     -->
    <div class="legend-section">
        <div class="legend-section-title">Routing Network:</div>
        <div class="legend-item">
            <span class="legend-label">Node Size:</span>
            <span class="legend-desc">Total connections</span>
        </div>
        
        <div class="legend-item">
            <span class="legend-label">Route Thickness:</span>
            <span class="legend-desc">Selected metric volume</span>
        </div>
        
        <div class="legend-item">
            <span class="legend-label">Route Color:</span>
            <div class="color-gradient route-gradient"></div>
            <span class="legend-desc">Low → High volume</span>
        </div>
    </div>
    
    <div class="legend-section">
        <div class="legend-section-title">Choropleth Layer:</div>
        <div class="legend-item">
            <span class="legend-label">Country Fill:</span>
            <div class="color-gradient choropleth-gradient"></div>
            <span class="legend-desc">Low → High seizures (kg, log scale)</span>
        </div>
    </div>
</div>
<!-- Choropleth Timeline Scrubber -->
<div class="choropleth-timeline" id="choropleth-timeline">
    <div class="timeline-title">Year</div>
    <div class="timeline-year-display" id="choropleth-year-display">2024</div>
    <input type="range" min="2010" max="2024" value="2024" class="timeline-scrubber" id="choropleth-year-scrubber">
    <div class="timeline-labels">
        <span>2010</span>
        <span>2024</span>
    </div>
</div>

    </div>
        </div>
        
        <!-- Overlay captions -->
        <div class="captions">
            <div class="caption" data-index="0">
                <p>With the so-called 'War on Drugs' focused primarily on supply-side enforcement, tracking cocaine seizures reveals the global scope of interdiction efforts. This network shows trafficking routes based on seizure data, with countries sized by their role as trafficking hubs.</p>
            </div>
            
            <div class="caption" data-index="1">
                <p>Routes are drawn between departure and destination countries, with thickness representing the volume of activity. You can switch between viewing the number of seizures (frequency of interdictions) or total quantity seized (volume in kilograms).</p>
            </div>

            <div class="caption" data-index="2">
                <p>The color gradient shows route intensity—lighter routes indicate lower volumes while darker red routes represent major trafficking corridors. Node size reflects each country's total connections in the network.</p>
            </div>

            <div class="caption" data-index="3">
                <p>The year filter allows you to examine how routes evolved over time. This network spans 2011-2016, showing which trafficking corridors were active during different periods of enforcement. An additional layer, of average amounts seized per year, can be toggled on and scrubbed from 2010 to 2024.</p>
            </div>
            
            <div class="caption" data-index="4">
                <p>Use the controls above to explore different metrics and time periods. Hover over routes and nodes for detailed statistics about seizure counts, quantities, and active years.</p>
            </div>
        </div>
        
    </div>
</section>

<!-- SECTION 5 - THE STRICTNESS INDEX-->
<section class="story-section strictness-index" id="strictness-index">
    <div class="section-content">
        <!-- <h2 class="section-header">5. The Strictness Index</h2> -->

        <!-- Isolation wrapper to prevent CSS conflicts -->
        <div style="all: initial; display: block;">
            <div class="strictness-rankings-container">
                
                <!-- Layout wrapper for sidebar design -->
                <div class="rankings-layout-wrapper">
                    
                    <!-- Sidebar containing all controls -->
                    <aside class="rankings-sidebar">
                        
                        <!-- TIME-SERIES CONTROLS -->
                        <div class="timeseries-controls-section">
                            <h3>
                                Time-Series Data Controls
                                <button class="sidebar-info-btn" data-info="timeseries">ⓘ</button>
                            </h3>
                            <p class="controls-description">
                                These settings apply to all time-series metrics (Seizures, Prevalence, Drug Prisoners %)
                            </p>
                            
                            <!-- SLIDER -->
                            <div class="timeseries-slider-control">
                                <label for="timeseries-range-slider">
                                    Calculate from: 
                                    <strong id="timeseries-range-display">Last 3 years</strong>
                                </label>
                                <input 
                                    type="range" 
                                    id="timeseries-range-slider" 
                                    min="1" 
                                    max="14" 
                                    value="3" 
                                    step="1"
                                    class="timeseries-slider"
                                >
                                <div class="slider-labels">
                                    <span>Last 1 year</span>
                                    <span>All years (14)</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- COMPONENT WEIGHTS CONTROLS -->
                        <div class="controls-section">
                            <h3>
                                Adjust Component Weights (Law in Books Only)
                                <button class="sidebar-info-btn" data-info="weights">ⓘ</button>
                            </h3>
                    
                            <div class="controls-grid">
                                <div class="component-controls">
                                    <div class="component-header" onclick="toggleComponent('criminalization')">
                                        <span>Criminalization Scope</span>
                                        <div class="component-weight">
                                            <input type="range" 
                                                   id="rankings-weight-criminalization" 
                                                   class="slider" 
                                                   min="0" 
                                                   max="100" 
                                                   value="50">
                                            <span id="rankings-weight-criminalization-display">50%</span>
                                            <span class="expand-indicator">▼</span>
                                        </div>
                                    </div>
                                    <div id="rankings-variables-criminalization" class="variable-controls">
                                        <div class="variable-item">
                                            <span>Use Criminalized</span>
                                            <div class="variable-weight">
                                                <input type="range" 
                                                       class="variable-slider" 
                                                       data-component="criminalization"
                                                       min="0" 
                                                       max="100" 
                                                       value="33.3">
                                                <span>16.7%</span>
                                            </div>
                                        </div>
                                        <div class="variable-item">
                                            <span>Possession Criminalized</span>
                                            <div class="variable-weight">
                                                <input type="range" 
                                                       class="variable-slider" 
                                                       data-component="criminalization"
                                                       min="0" 
                                                       max="100" 
                                                       value="33.3">
                                                <span>16.7%</span>
                                            </div>
                                        </div>
                                        <div class="variable-item">
                                            <span>No Personal Use Exemption</span>
                                            <div class="variable-weight">
                                                <input type="range" 
                                                       class="variable-slider" 
                                                       data-component="criminalization"
                                                       min="0" 
                                                       max="100" 
                                                       value="33.3">
                                                <span>16.7%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="component-controls">
                                    <div class="component-header" onclick="toggleComponent('penalty')">
                                        <span>Penalty Severity</span>
                                        <div class="component-weight">
                                            <input type="range" 
                                                   id="rankings-weight-penalty" 
                                                   class="slider" 
                                                   min="0" 
                                                   max="100" 
                                                   value="50">
                                            <span id="rankings-weight-penalty-display">50%</span>
                                            <span class="expand-indicator">▼</span>
                                        </div>
                                    </div>
                                    <div id="rankings-variables-penalty" class="variable-controls">
                                        <div class="variable-item">
                                            <span>Max Possession Penalty</span>
                                            <div class="variable-weight">
                                                <input type="range" 
                                                       class="variable-slider" 
                                                       data-component="penalty"
                                                       min="0" 
                                                       max="100" 
                                                       value="33.3">
                                                <span>16.7%</span>
                                            </div>
                                        </div>
                                        <div class="variable-item">
                                            <span>Max Supply Penalty</span>
                                            <div class="variable-weight">
                                                <input type="range" 
                                                       class="variable-slider" 
                                                       data-component="penalty"
                                                       min="0" 
                                                       max="100" 
                                                       value="33.3">
                                                <span>16.7%</span>
                                            </div>
                                        </div>
                                        <div class="variable-item">
                                            <span>Mandatory Minimums</span>
                                            <div class="variable-weight">
                                                <input type="range" 
                                                       class="variable-slider" 
                                                       data-component="penalty"
                                                       min="0" 
                                                       max="100" 
                                                       value="33.3">
                                                <span>16.7%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button class="reset-button" onclick="resetWeights()">Reset to Default Weights</button>
                        </div>
                        
                    </aside>
                    <!-- END: Sidebar -->
                    
                    <!-- Main rankings area -->
                    <div class="rankings-main-area">
                        
                        <!-- Mobile Column Selector -->
                        <div class="mobile-column-selector" id="rankings-mobile-selector">
                            <!-- Will be populated dynamically -->
                        </div>

                        <!-- Unified Rankings Container -->
                        <div class="rankings-container">
                            <canvas id="rankings-canvas"></canvas>
                            <div class="rankings-grid" id="rankings-grid">
                                <!-- Columns will be populated dynamically -->
                            </div>
                        </div>
                        
                    </div>
                    <!-- END: Main area -->
                    
                </div>
                <!-- END: Layout wrapper -->

                <!-- Tooltip -->
                <div class="tooltip" id="rankings-tooltip"></div>
                
            </div>
        </div> <!-- End isolation wrapper -->
        
    </div>
</section>
            
<!-- SECTION 6 - DASHBOARD -->
    <!-- Dashboard Section -->
    <section class="dashboard" id="dashboard">
        <div class="section-content">
            <h2 class="section-header">6. Interact with the Data</h2>
            
        </div>
    </section>

    <!-- Tooltip for interactions -->
    <div class="tooltip" id="tooltip"></div>


<!-- STATUS LEGEND -->
<div class="status-legend" id="status-legend" style="display: none;">
    <h4>Treaty Status</h4>
    
    <div class="status-item">
        <div class="status-dot status-ratified"></div>
        <span>Ratified</span>
    </div>
    
    <div class="status-item">
        <div class="status-dot status-ratified-reservation"></div>
        <span>With Reservation</span>
    </div>
    
    <div class="status-item">
        <div class="status-dot status-signed-only"></div>
        <span>Signed Only</span>
    </div>
    
    <div class="status-item">
        <div class="status-dot status-never-signed"></div>
        <span>Never Signed</span>
    </div>
    
    <div class="status-item">
        <div class="status-dot status-withdrew"></div>
        <span>Withdrew</span>
    </div>
    
    <hr style="margin: 10px 0; border: none; border-top: 1px solid #ddd;">
    
    <h4 style="margin-top: 10px;">Link Styles</h4>
    
    <div class="status-item">
        <div class="status-line status-ratified"></div>
        <span>Clean ratification</span>
    </div>
    
    <div class="status-item">
        <div class="status-line dashed status-ratified-reservation"></div>
        <span>With reservation</span>
    </div>
    
    <div class="status-item">
        <div class="status-line dotted status-signed-only"></div>
        <span>Signed only</span>
    </div>
</div>

<!-- TEMPORAL SCALE -->
<!-- Shows what distance means in years -->

<div class="temporal-scale" id="temporal-scale" style="display: none;">
    <h4>Distance = Years to Join</h4>
    
    <div class="scale-line">
        <div class="scale-bar" style="width: 40px;"></div>
        <span>5 years</span>
    </div>
    
    <div class="scale-line">
        <div class="scale-bar" style="width: 80px;"></div>
        <span>10 years</span>
    </div>
    
    <div class="scale-line">
        <div class="scale-bar" style="width: 160px;"></div>
        <span>20 years</span>
    </div>
    
    <p style="margin-top: 10px; font-size: 9px; opacity: 0.7; line-height: 1.3;">
        Distance from treaty center indicates how many years after adoption each country joined.
    </p>
</div>

<!-- JavaScript to show/hide legend when treaties are expanded -->
<script>
// Show legend when any treaty is expanded
function updateLegendVisibility() {
    const anyExpanded = treatyViz.expandedTreaties.size > 0;
    document.getElementById('status-legend').style.display = anyExpanded ? 'block' : 'none';
    document.getElementById('temporal-scale').style.display = anyExpanded ? 'block' : 'none';
}

// Call this after expanding/collapsing treaties
// Add to end of expandTreaty() and collapseTreaty() functions:
// updateLegendVisibility();
</script>


</body>
</html>